<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>股市卧底游戏 - 游戏中</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/game.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <!-- 游戏头部信息 -->
        <div class="row bg-dark text-white py-2">
            <div class="col-md-3">
                <h5>股市卧底游戏</h5>
                <small>游戏ID: {{ game_id }}</small>
            </div>
            <div class="col-md-6 text-center">
                <h4 id="current-phase">等待开始...</h4>
                <div id="phase-timer" class="progress mt-2">
                    <div class="progress-bar" role="progressbar" style="width: 100%"></div>
                </div>
            </div>
            <div class="col-md-3 text-end">
                <div id="player-info">
                    <strong id="player-name"></strong><br>
                    <small>角色: <span id="player-role">未知</span></small><br>
                    <small>资金: $<span id="player-money">1000</span></small>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- 左侧面板 - 玩家列表和股票市场 -->
            <div class="col-md-3">
                <!-- 玩家列表 -->
                <div class="card mt-3">
                    <div class="card-header">玩家列表</div>
                    <div class="card-body p-2" id="player-list"></div>
                </div>

                <!-- 股票市场 -->
                <div class="card mt-3">
                    <div class="card-header">股票市场</div>
                    <div class="card-body p-2" id="stock-list"></div>
                    <select id="stock-select" class="form-select mt-2"></select>
                </div>

                <!-- 我的投资组合 -->
                <div class="card mt-3">
                    <div class="card-header">我的投资组合</div>
                    <div class="card-body p-2" id="player-holdings"></div>
                </div>

                <!-- 我的卡牌 -->
                <div class="card mt-3">
                    <div class="card-header">我的卡牌</div>
                    <div class="card-body p-2" id="player-cards"></div>
                </div>
            </div>

            <!-- 中间面板 - 主要游戏区域 -->
            <div class="col-md-6">
                <!-- 投资面板 -->
                <div id="investment-panel" class="card mt-3" style="display: none;">
                    <div class="card-header">
                        <h6>投资操作</h6>
                    </div>
                    <div class="card-body">
                        <form id="investment-form">
                            <div class="row">
                                <div class="col-md-4">
                                    <select class="form-select" id="stock-select">
                                        <option value="">选择股票</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <input type="number" class="form-control" id="investment-amount" placeholder="金额" min="10">
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select" id="investment-action">
                                        <option value="buy">买入</option>
                                        <option value="sell">卖出</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <button type="submit" class="btn btn-primary">执行</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- 聊天面板 -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6>游戏聊天</h6>
                    </div>
                    <div class="card-body p-2" id="messages" style="height:200px;overflow-y:auto;"></div>
                    <div class="card-footer">
                        <input id="message-input" class="form-control" placeholder="输入消息...">
                        <button id="send-message-btn" class="btn btn-primary mt-2">发送</button>
                    </div>
                </div>

                <!-- 投票面板 -->
                <div id="voting-panel" class="card mt-3" style="display: none;">
                    <div class="card-header">投票淘汰</div>
                    <div class="card-body" id="vote-results"></div>
                    <button id="vote-btn" class="btn btn-primary mt-2">投票</button>
                </div>
            </div>

            <!-- 右侧面板 - 卡牌和操作 -->
            <div class="col-md-3">
                <!-- 游戏日志 -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6>游戏日志</h6>
                    </div>
                    <div class="card-body p-2">
                        <div id="game-log" style="height: 200px; overflow-y: auto; font-size: 0.8em;"></div>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="card mt-3">
                    <div class="card-body p-2">
                        <button id="next-phase-btn" class="btn btn-warning w-100 mb-2" style="display: none;">进入下一阶段</button>
                        <button id="leave-game-btn" class="btn btn-danger w-100">离开游戏</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 卡牌使用模态框 -->
    <div class="modal fade" id="cardModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">使用卡牌</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="card-details"></div>
                    <div id="target-selection" style="display: none;">
                        <label class="form-label">选择目标玩家：</label>
                        <select class="form-select" id="card-target-select">
                            <option value="">选择目标</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="use-card-btn">使用卡牌</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 游戏结束模态框 -->
    <div class="modal fade" id="gameEndModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">游戏结束</h5>
                </div>
                <div class="modal-body">
                    <div id="game-result"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="window.location.href='/'">返回主页</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
    <script>
const gameId = "{{ game_id }}";
let playerName = localStorage.getItem('player_name');
if (!playerName) {
    playerName = prompt("请输入你的昵称：");
    localStorage.setItem('player_name', playerName);
}
const socket = io();
// 加入房间
socket.emit('join_game', {
    game_id: gameId,
    player_name: playerName
});
</script>
</body>
</html>